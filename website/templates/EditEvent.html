{% extends "base.html" %}
{% block title %}Edit Event | Poly Beats{% endblock %}
{% block content %}

<main class="container py-4">
  <div class="site-panel p-4 p-lg-5">
    <h2 class="h4 mb-3">Edit Event</h2>

<form method="post" action="{{ url_for('main.EditEvent', event_id=event.event_id) }}" 
      enctype="multipart/form-data" class="row g-3">
      {{ form.csrf_token }}

            <div class="col-md-8">
        {{ form.title.label(class="form-label") }}
        {{ form.title(class="form-control", placeholder="Event Title") }}
      </div>

      <div class="col-md-4">
        {{ form.genre.label(class="form-label") }}
        {{ form.genre(class="form-select") }}
      </div>

      <div class="col-12">
        {{ form.description.label(class="form-label") }}
        {{ form.description(class="form-control", rows="4") }}
      </div>

      <div class="col-md-6">
        {{ form.location.label(class="form-label") }}
        {{ form.location(class="form-control") }}
      </div>

      <div class="col-md-3">
        {{ form.event_date.label(class="form-label") }}
        {{ form.event_date(class="form-control") }}
      </div>

      <div class="col-md-3">
        {{ form.start_time.label(class="form-label") }}
        {{ form.start_time(class="form-control") }}
      </div>

      <div class="col-md-3">
        {{ form.end_time.label(class="form-label") }}
        {{ form.end_time(class="form-control") }}
      </div>

      <div class="col-md-4">
        <label class="form-label">Event Image</label>
        <input type="file" name="img_file" class="form-control" accept="image/*">
        <small class="text-muted">Current: {{ event.img }}</small>
      </div>

      <div class="col-md-4">
        <label class="form-label fw-semibold">Event Status</label>
        <select class="form-select" name="status" required>
          <option value="Open" {% if event.status == 'Open' %}selected{% endif %}>Open</option>
          <option value="Sold Out" {% if event.status == 'Sold Out' %}selected{% endif %}>Sold Out</option>
          <option value="Inactive" {% if event.status == 'Inactive' %}selected{% endif %}>Inactive</option>
        </select>
      </div>


      <hr class="my-4">
      <h5 class="fw-semibold">Ticket Types</h5>

      <div id="ticket-types-wrapper">
        {% for t in ticket_types %}
        <div class="row g-3 ticket-type-row mb-2">
          <div class="col-md-4">
            <input class="form-control" name="ticket_label[]" value="{{ t.label }}" required>
          </div>
          <div class="col-md-4">
            <input type="number" class="form-control" name="ticket_price[]" value="{{ t.price }}" min="0" required>
          </div>
          <div class="col-md-4">
            <input type="number" class="form-control" name="ticket_quota[]" value="{{ t.quota }}" min="1" required>
          </div>
        </div>
        {% endfor %}
      </div>

      <button type="button" id="add-ticket-btn" class="btn btn-outline-secondary btn-sm my-2">
        Add another ticket type
      </button>

      <div class="col-12">
        <button type="submit" class="btn btn-dark">Save Changes</button>
        <a href="{{ url_for('main.event_detail', event_id=event.event_id) }}" class="btn btn-outline-secondary">Cancel</a>
      </div>

    </form>
  </div>
</main>

<script>
/* Re-use the same JS from CreateEvent.html */
document.getElementById("add-ticket-btn").addEventListener("click", function () {
    const wrapper = document.getElementById("ticket-types-wrapper");
    const newRow = document.createElement("div");
    newRow.classList.add("row", "g-3", "ticket-type-row", "mb-2");
    newRow.innerHTML = `
      <div class="col-md-4"><input class="form-control" name="ticket_label[]" placeholder="Label" required></div>
      <div class="col-md-4"><input type="number" class="form-control" name="ticket_price[]" placeholder="Price" min="0" required></div>
      <div class="col-md-4"><input type="number" class="form-control" name="ticket_quota[]" placeholder="Quota" min="1" required></div>
    `;
    wrapper.appendChild(newRow);
});
</script>

{% endblock %}
