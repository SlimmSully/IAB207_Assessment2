{% extends "base.html" %}
{% block title %}{{ event.title }} | Poly Beats{% endblock %}
{% block content %}

<!-- Event Details Section -->
<div class="container my-5">
  <div class="row">
    <!-- Event Image -->
    <div class="col-md-6">
      <img src="{{ url_for('static', filename='img/' + event.img) }}" 
           alt="{{ event.title }}"
           class="img-fluid rounded" alt="Event Image">
    </div>

    <!-- Event Info -->
    <div class="col-md-6">
      <h2 class="fw-bold text-inkwell">{{ event.title }}
        <span id="eventStatus"
              class="badge 
              {% if event.status == 'Open' %}bg-success{% elif event.status == 'Cancelled' %}bg-danger{% else %}bg-secondary{% endif %}">
          {{ event.status }}
        </span>
      </h2> 
      <p><strong>Date:</strong> {{ event.event_date.strftime("%d %B %Y") if event.event_date else "TBA" }}</p>
      <p><strong>Time:</strong>
         {% if event.start_time and event.end_time %}
           {{ event.start_time.strftime("%I:%M %p") }} â€“ {{ event.end_time.strftime("%I:%M %p") }}
         {% else %}
           TBA
         {% endif %}
      </p>
      <p><strong>Venue:</strong> {{ event.location }}</p>
      <p>{{ event.description }}</p>

      {% if event.status == 'Open' %}
        <!-- Booking Form -->
        <div class="card p-3 mt-3" id="bookingCard">
          <h5>Book Tickets</h5>
          {% if current_user.is_authenticated %}
          <form method="POST">
            {{ booking_form.hidden_tag() }}
            <div class="mb-3">
              {{ booking_form.ticket_type.label(class="form-label") }}
              {{ booking_form.ticket_type(class="form-select") }}
            </div>
            <div class="mb-3">
              {{ booking_form.ticket_quantity.label(class="form-label") }}
              {{ booking_form.ticket_quantity(class="form-control") }}
            </div>
            {{ booking_form.submit(class="btn btn-success") }}
          </form>

          {% else %}
          <p>You must <a href="{{ url_for('auth.login') }}">log in</a> to book tickets.</p>
          {% endif %}

          {% if booking_message %}
          <div class="alert alert-success mt-3">{{ booking_message }}</div>
          {% endif %}
        </div>

      {% elif event.status == 'Sold Out' %}
        <button class="btn btn-secondary" disabled>Sold Out</button>
      {% elif event.status == 'Cancelled' %}
        <button class="btn btn-danger" disabled>Cancelled</button>
      {% endif %}
    </div>
  </div>
    <!-- Comments Section -->
  <div class="mt-5">
    <h4>Comments</h4>

    <!-- Existing Comments -->
    {% for c in comments %}
    <div class="mb-3 p-3 border rounded bg-light">
      <strong>{{ c.user.first_name if c.user else 'Anonymous' }}:</strong>
      {{ c.content }}
      <br>
      <small class="text-muted">{{ c.posted_at.strftime("%d %b %Y %I:%M %p") }}</small>
    </div>
    {% else %}
    <p>No comments yet. Be the first to comment!</p>
    {% endfor %}

    <!-- Comment Form -->
    <div class="card p-3 mt-3">
      <h5>Leave a Comment</h5>
      {% if current_user.is_authenticated %}
      <form method="POST">
        {{ comment_form.hidden_tag() }}
        <div class="mb-3">
          {{ comment_form.content(class="form-control", rows="3", placeholder="Write your comment...") }}
          {% for err in comment_form.content.errors %}
          <div class="text-danger small">{{ err }}</div>
          {% endfor %}
        </div>
        {{ comment_form.submit(class="btn btn-primary") }}
      </form>
      {% else %}
      <p>You must <a href="{{ url_for('auth.login') }}">log in</a> to comment.</p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}

