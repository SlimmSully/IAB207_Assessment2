{% extends "base.html" %}
{% block content %}

<!-- Event Details Section -->
<div class="container py-5">
  <div class="row align-items-center">
    <!-- Event Image -->
    <div class="col-md-6 mb-4 mb-md-0">
      <img src="{{ url_for('static', filename='img/' + event.img) }}" 
           alt="{{ event.title }}"
           class="img-fluid rounded shadow">
    </div>

    <!-- Event Info -->
    <div class="col-md-6">
      <h1 class="fw-bold text-inkwell">{{ event.title }}</h1>
      <p class="text-muted">{{ event.description }}</p>
      <ul class="list-unstyled">
        <li><strong>Date:</strong> {{ event.event_date.strftime('%d %B %Y') }}</li>
        <li><strong>Time:</strong> {{ event.start_time.strftime('%I:%M %p') }} â€“ {{ event.end_time.strftime('%I:%M %p') }}</li>
        <li><strong>Location:</strong> {{ event.location }}</li>
        <li><strong>Status:</strong>
          <span class="badge 
            {% if event.status == 'Open' %}bg-success
            {% elif event.status == 'Sold Out' %}bg-secondary
            {% elif event.status == 'Cancelled' %}bg-danger
            {% else %}bg-dark{% endif %}">
            {{ event.status }}
          </span>
        </li>
      </ul>

      {% if event.status == 'Open' %}
        <!-- Booking Form -->
        <div class="card p-3 mt-4 shadow-sm" id="bookingCard">
          <h5 class="mb-3">Book Tickets</h5>

          {% if current_user.is_authenticated %}
          <form method="POST">
            {{ booking_form.hidden_tag() }}
            <div class="mb-3">
              {{ booking_form.ticket_type.label(class="form-label") }}
              {{ booking_form.ticket_type(class="form-select") }}
            </div>
            <div class="mb-3">
              {{ booking_form.ticket_quantity.label(class="form-label") }}
              {{ booking_form.ticket_quantity(class="form-control") }}
            </div>
            {{ booking_form.submit(class="btn btn-success w-100") }}
          </form>

          {% if booking_message %}
          <div class="alert alert-success mt-3">{{ booking_message }}</div>
          {% endif %}

          {% else %}
          <p>You must <a href="{{ url_for('auth.login') }}">log in</a> to book tickets.</p>
          {% endif %}
        </div>

      {% elif event.status == 'Sold Out' %}
        <button class="btn btn-secondary px-4 mt-2" disabled>Sold Out</button>
      {% elif event.status == 'Cancelled' %}
        <button class="btn btn-danger px-4 mt-2" disabled>Cancelled</button>
      {% endif %}
    </div>
  </div>
</div>

<!-- Comments Section -->
<div class="container my-5">
  <div class="row justify-content-center">
    <div class="col-lg-8">   
      <h3 class="mb-4 text-inkwell border-bottom pb-2">Comments</h3>

      <!-- Existing Comments -->
      {% for c in comments %}
      <div class="comment-card border rounded p-3 mb-3 bg-light shadow-sm">
        <div class="d-flex justify-content-between">
          <span class="fw-bold text-au-lait">{{ c.user.first_name }} {{ c.user.last_name }}</span>
          <small class="text-muted">{{ c.posted_at.strftime('%d %b %Y %I:%M %p') }}</small>
        </div>
        <p class="mt-2 mb-0 text-inkwell">{{ c.content }}</p>
      </div>
      {% else %}
      <p class="text-muted fst-italic">No comments yet. Be the first to comment!</p>
      {% endfor %}
      
      <hr class="my-4">

      <!-- Comment Form -->
      {% if current_user.is_authenticated %}
      <form method="POST">
        {{ comment_form.hidden_tag() }}
        <div class="mb-3">
          {{ comment_form.content.label(class="form-label") }}
          {{ comment_form.content(class="form-control", rows="3") }}
        </div>
        {{ comment_form.submit(class="btn btn-primary") }}
      </form>
      {% else %}
      <p>You must <a href="{{ url_for('auth.login') }}">log in</a> to post a comment.</p>
      {% endif %}
    </div>
  </div>
</div>

{% endblock %}

